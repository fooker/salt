<VirtualHost *:80>
  ServerName open-desk.org
  ServerAlias www.open-desk.org

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName open-desk.org
  ServerAlias www.open-desk.org

  DocumentRoot /srv/http/open_desk

  DirectoryIndex index.php

  <Directory /srv/http/open_desk>
    Require all granted

    RewriteEngine On
    RewriteBase /
    RewriteRule ^index\.php$ - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.php [L]
  </Directory>

  <Directory /srv/data/open_desk>
    Require all granted
  </Directory>

  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/domains/open_desk.crt
  SSLCertificateKeyFile /etc/letsencrypt/domains.key

  Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains; preload"
</VirtualHost>

