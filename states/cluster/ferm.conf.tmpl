### This file is managed by saltstack - any changes will be overwritten ###

domain ip
table filter
chain INPUT {

  # Allow IPSec
  proto udp
  dport (500 4500)
  ACCEPT;

  proto esp
  ACCEPT;

  # Allow GRE
  proto gre
  mod policy
  dir in
  pol ipsec
  ACCEPT;
}

# Allow all cluster traffic
domain ip6
table filter
chain INPUT
interface (
{% for node in pillar['cluster']['nodes'] if node != grains['id'] -%}
  cluster-{{ pillar['cluster']['nodes'].index(node) }}
{% endfor -%}
)
ACCEPT;

